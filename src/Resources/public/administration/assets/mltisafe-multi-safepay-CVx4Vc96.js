const l=`<template v-if="isRefundAllowed"> <mt-card title="Refund" :isLoading="isLoading" class="sw-order-detail-base__line-item-grid-card" role="region" :aria-label="$t('multisafepay-refund.refund_options')"> <mt-number-field label="Amount" name="sw-field--amount" v-model="amount" placeholder="0.00" number-type="float" :step="0.01" :max="maxRefundableAmount" :disabled="isRefundDisabled" aria-required="true"> </mt-number-field> <mt-button variant="primary" @click="showRefundModal()" :disabled="isRefundDisabled" :aria-label="$t('multisafepay-refund.process_refund')"> Refund </mt-button> <span class="float-right"> <strong>Amount refunded: {{ order ? order.currency.symbol : 'currency' }}&nbsp;{{ refundedAmount }}</strong> </span> <sw-modal v-show="showModal" title="MultiSafepay refund" variant="small" @modal-close="closeModal()" role="dialog" aria-live="polite" :aria-label="$t('multisafepay-refund.confirm_refund')"> <template #default> Are you sure you want to refund {{ order ? order.currency.symbol : 'currency' }}{{ this.amount }}? <br/> </template> <template #modal-footer> <mt-button @click="closeModal()" size="small" :aria-label="$t('multisafepay-refund.cancel_refund')"> {{ $t('global.default.cancel') }} </mt-button> <mt-button @click="confirmRefund()" size="small" variant="primary" :aria-label="$t('multisafepay-refund.confirm_process_refund')"> {{ $t('multisafepay-refund.confirm') }} </mt-button> </template> </sw-modal> </mt-card> </template>`,{Component:u,Mixin:p}=Shopware,{Criteria:d}=Shopware.Data;u.register("multisafepay-refund",{template:l,inject:["repositoryFactory","orderService","stateStyleDataProviderService","multiSafepayApiService"],mixins:[p.getByName("notification")],props:{orderId:{type:String,required:!0}},data(){return{amount:null,isLoading:null,versionContext:null,order:null,maxRefundableAmount:0,isRefundAllowed:!0,refundedAmount:0,showModal:!1,isRefundDisabled:!1,isFirstTab:!1}},watch:{orderId(){this.createdComponent()},amount(){this.amount=parseFloat(this.amount).toFixed(2)},refundedAmount(){this.refundedAmount=parseFloat(this.refundedAmount).toFixed(2)}},methods:{closeModal(){this.showModal=!1,this.isFirstTab=!0},showRefundModal(){if(this.amount<.01){this.createNotificationWarning({title:"Invalid amount",message:"Fill in a valid amount"});return}this.showModal=!0,this.isFirstTab=!0},confirmRefund(){this.isLoading||(this.isLoading=!0,this.closeModal(),this.multiSafepayApiService.refund(this.amount,this.orderId).then(e=>{if(e.status===!1){this.createNotificationError({title:"Failed to refund",message:"The refund could not be processed. Please check the payment status and try again. Error details: "+e.message});return}this.createNotificationSuccess({title:"Success",message:"Successfully refunded"}),this.reloadEntityData()}).catch(e=>{this.createNotificationError({title:"Error",message:"An unexpected error occurred while processing the refund. Please contact support if this problem persists. Error details: "+(e.message||"Unknown error")})}).finally(()=>{this.isLoading=!1}))},createdComponent(){this.versionContext=Shopware.Context.api,this.reloadEntityData()},reloadEntityData(){return this.isLoading=!0,this.orderRepository.get(this.orderId,this.versionContext,this.orderCriteria).then(e=>(this.order=e,this.multiSafepayApiService.getRefundData(this.order.id).then(t=>{this.isRefundAllowed=t.isAllowed,this.refundedAmount=t.refundedAmount,this.maxRefundableAmount=this.order.amountTotal-this.refundedAmount,this.isRefundDisabled=this.order.amountTotal-this.refundedAmount===0,this.isLoading=!1}).catch(()=>{this.isRefundAllowed=!1}),Promise.resolve())).catch(()=>Promise.reject())},handleKeydown(e){e.key==="Escape"&&this.showModal&&this.closeModal(),e.key==="Tab"&&this.showModal&&this.isFirstTab&&(e.preventDefault(),this.focusModalCloseButton(),this.isFirstTab=!1)},focusModalCloseButton(){const e=document.querySelector(".sw-modal__close");e&&e.focus()}},computed:{orderRepository(){return this.repositoryFactory.create("order")},orderCriteria(){return new d(this.page,this.limit).addAssociation("currency")}},created(){this.createdComponent()},mounted(){document.addEventListener("keydown",this.handleKeydown)},beforeDestroy(){document.removeEventListener("keydown",this.handleKeydown)}});const c=`<div> <sw-button-process :isLoading="isLoading" @click="check"> {{ $t('multisafepay-verify-api-key.apiButton') }} </sw-button-process> </div>`,{Component:m,Mixin:f}=Shopware;m.register("multisafepay-verify-api-key",{template:c,inject:["multiSafepayApiService"],mixins:[f.getByName("notification")],data(){return{isLoading:!1,maxAttempts:10}},computed:{globalPluginConfig(){let e,t=this.$parent;for(let a=0;a<this.maxAttempts;a++){if(t&&t.actualConfigData)return e=t.actualConfigData.null,e;t=t.$parent}return null},actualPluginConfig(){let e,t,a=this.$parent;for(let n=0;n<this.maxAttempts;n++){if(a&&a.currentSalesChannelId)e=a.currentSalesChannelId;else return null;if(a&&a.actualConfigData&&a.actualConfigData[e])return t=a.actualConfigData[e],t;a=a.$parent}return null}},methods:{check(){this.isLoading=!0,this.multiSafepayApiService.verifyApiKey(this.globalPluginConfig,this.actualPluginConfig).then(e=>{if(e.success===!1){this.createNotificationWarning({title:"MultiSafepay",message:this.$t("multisafepay-verify-api-key.error")}),this.isLoading=!1;return}this.createNotificationSuccess({title:"MultiSafepay",message:this.$t("multisafepay-verify-api-key.success")}),this.isLoading=!1})}}});const h=`<template> <div class="multisafepay-support" role="region" :aria-label="'MultiSafepay ' + $t('multisafepay-support.documentation')"> <mt-container> <h2 class="multisafepay-title">{{ $t("multisafepay-support.documentation") }}</h2> <p class="mb-1">{{ $t("multisafepay-support.read_docs") }}:</p> <h3 class="mt-1">{{ $t("multisafepay-support.general_information") }}</h3> <ul class="multisafepay-ul"> <li> <a href="https://docs.multisafepay.com/docs/shopware-6" target="_blank" rel="noopener" :aria-label="$t('multisafepay-support.manual') + ' - ' + $t('multisafepay-support.external_link')"> {{ $t('multisafepay-support.manual') }} <span class="sr-only"> – Opens in a new window</span> </a> </li> <li> <a href="https://github.com/MultiSafepay/shopware6/blob/master/CHANGELOG.md" target="_blank" rel="noopener" :aria-label="$t('multisafepay-support.changelog') + ' - ' + $t('multisafepay-support.external_link')"> {{ $t("multisafepay-support.changelog") }} <span class="sr-only"> – Opens in a new window</span> </a> </li> </ul> <h3 class="mt-1">{{ $t("multisafepay-support.for_developers") }}</h3> <ul class="multisafepay-ul"> <li> <a href="https://docs.multisafepay.com/reference/introduction" target="_blank" rel="noopener" :aria-label="$t('multisafepay-support.api_documentation') + ' - ' + $t('multisafepay-support.external_link')"> {{ $t("multisafepay-support.api_documentation") }} <span class="sr-only"> – Opens in a new window</span> </a> </li> <li> <a href="https://github.com/MultiSafepay/Shopware6" target="_blank" rel="noopener" :aria-label="'MultiSafepay GitHub - ' + $t('multisafepay-support.external_link')"> MultiSafepay GitHub <span class="sr-only"> – Opens in a new window</span> </a> </li> </ul> <h2 class="mt-1">{{ $t("multisafepay-support.account")}}</h2> <section role="region" :aria-label="$t('multisafepay-support.account')"> <p>{{ $t("multisafepay-support.account_needed") }}</p> <p class="mt-1" v-html='$t("multisafepay-support.test_account")'></p> <p class="mt-1" v-html='$t("multisafepay-support.live_account")'></p> <ul class="multisafepay-ul-none mt-1" :aria-label="$t('multisafepay-support.contact') + ' - ' + $t('multisafepay-support.sales')"> <li> {{ $t("multisafepay-support.telephone") }}: <a href="tel:+31208500501" :aria-label="$t('multisafepay-support.telephone') + ': +31 (0)20 - 8500501'"> +31 (0)20 - 8500501 </a> </li> <li> {{ $t("multisafepay-support.e-mail") }}: <a href="mailto:sales@multisafepay.com" :aria-label="$t('multisafepay-support.e-mail') + ': sales@multisafepay.com'"> sales@multisafepay.com </a> </li> </ul> </section> <h2 class="mt-1">{{ $t("multisafepay-support.contact") }}</h2> <section role="region" :aria-label="$t('multisafepay-support.contact')"> <p>{{ $t("multisafepay-support.assistance_integration_team") }}</p> <ul class="multisafepay-ul-none mt-1" :aria-label="$t('multisafepay-support.contact') + ' - ' + $t('multisafepay-support.integration')"> <li> {{ $t("multisafepay-support.telephone") }}: <a href="tel:+31208500500" :aria-label="$t('multisafepay-support.telephone') + ': +31 (0)20 - 8500500'"> +31 (0)20 - 8500500 </a> </li> <li> {{ $t("multisafepay-support.e-mail") }}: <a href="mailto:integration@multisafepay.com" :aria-label="$t('multisafepay-support.e-mail') + ': integration@multisafepay.com'"> integration@multisafepay.com </a> </li> </ul> </section> </mt-container> </div> </template>`,{Component:y}=Shopware;y.register("multisafepay-support",{template:h,data(){return{}},created(){},mounted(){const e=this.$el.closest("template.sw-form-field-renderer");e&&(e.style.display="block");let t=this.$el;for(;t;)window.getComputedStyle(t).display==="none"&&(t.style.display="block"),t=t.parentElement}});const g=`{% block sw_settings_payment_detail_content_field_after_order_enabled %} {% parent %} <mt-switch v-if="isComponentAllowed" v-model="paymentMethod.customFields.component" name="sw-field--paymentMethod-customFields.component" class="sw-settings-payment-detail__field-custom-fields-component" label="Component" :help-text="$t('multisafepay-component.help_text')" ></mt-switch> <mt-switch v-if="isTokenizationAllowed" v-model="paymentMethod.customFields.tokenization" name="sw-field--paymentMethod-customFields.tokenization" class="sw-settings-payment-detail__field-custom-fields-tokenization" label="Tokenization" :help-text="$t('multisafepay-tokenization.help_text')" :disabled="isTokenizationDisabled" ></mt-switch> <mt-switch v-if="isMyBankDirectSupported" v-model="paymentMethod.customFields.direct" name="sw-field--paymentMethod-customFields.direct" class="sw-settings-payment-detail__field-custom-fields-direct" label="Pay inside checkout" :help-text="$t('multisafepay-direct.help_text')" ></mt-switch> {% endblock %}`,{Component:b}=Shopware,k=["americanexpress","creditcard","maestro","mastercard","mbway","payafterdeliverymf","visa"],_=["americanexpress","creditcard","maestro","mastercard","mbway","visa"];b.override("sw-settings-payment-detail",{template:g,data(){return{tokenizationSupported:!1,componentSupported:!1}},inject:["multiSafepayApiService"],computed:{isTokenizationDisabled(){return!(this.paymentMethod&&this.paymentMethod.customFields&&this.paymentMethod.customFields.component)||!this.isComponentAllowed},isMyBankDirectSupported(){return this.paymentMethod&&this.paymentMethod.handlerIdentifier&&this.paymentMethod.handlerIdentifier.toLowerCase().includes("mybank")},isComponentAllowed(){if(!this.paymentMethod||!this.paymentMethod.handlerIdentifier)return!1;const e=this.paymentMethod.handlerIdentifier.toLowerCase();return k.some(a=>e.includes(a))&&this.componentSupported},isTokenizationAllowed(){if(!this.paymentMethod||!this.paymentMethod.handlerIdentifier)return!1;const e=this.paymentMethod.handlerIdentifier.toLowerCase();return _.some(a=>e.includes(a))&&this.tokenizationSupported}},watch:{paymentMethod(){this.paymentMethod||(this.paymentMethod={}),this.paymentMethod.id||(this.paymentMethod.id=null),this.paymentMethod.customFields||(this.paymentMethod.customFields={}),this.paymentMethod.customFields.tokenization||(this.paymentMethod.customFields.tokenization=!1),this.paymentMethod.customFields.component||(this.paymentMethod.customFields.component=!1),this.paymentMethod.customFields.direct||(this.paymentMethod.customFields.direct=!1),this.reloadEntityData()},"paymentMethod.customFields.component"(e){!e&&this.paymentMethod&&this.paymentMethod.customFields&&this.paymentMethod.customFields.tokenization&&(this.paymentMethod.customFields.tokenization=!1)},"paymentMethod.handlerIdentifier"(){this.reloadEntityData()}},mounted(){this.reloadEntityData()},methods:{reloadEntityData(){if(!this.paymentMethod||!this.paymentMethod.id){this.componentSupported=!1,this.tokenizationSupported=!1;return}this.multiSafepayApiService.isTokenizationAllowed(this.paymentMethod.id).then(e=>{this.tokenizationSupported=e.supported||!1}).catch(()=>{this.tokenizationSupported=!1}),this.multiSafepayApiService.isComponentAllowed(this.paymentMethod.id).then(e=>{this.componentSupported=e.supported||!1}).catch(()=>{this.componentSupported=!1})}}});const w='{% block sw_order_detail_general_line_items_card %} {% parent %} <multisafepay-refund :orderId="orderId"></multisafepay-refund> {% endblock %}';Shopware.Component.override("sw-order-detail-general",{template:w});const S='{% block sw_order_detail_base_line_items_card %} {% parent %} <multisafepay-refund :orderId="orderId"></multisafepay-refund> {% endblock %}';Shopware.Component.override("sw-order-detail-base",{template:S});const i=Shopware.Classes.ApiService;class v extends i{constructor(t,a,n="multisafepay"){super(t,a,n)}refund(t,a){const n=`${this.getApiBasePath()}/refund`;return this.httpClient.post(n,{amount:t*100,orderId:a},{headers:this.getBasicHeaders()}).then(o=>i.handleResponse(o)).catch(o=>i.handleResponse(o))}getRefundData(t){const a=`${this.getApiBasePath()}/get-refund-data`;return this.httpClient.post(a,{orderId:t},{headers:this.getBasicHeaders()}).then(n=>i.handleResponse(n))}verifyApiKey(t,a){const n=`${this.getApiBasePath()}/verify-api-key`,o=this.getBasicHeaders();return this.httpClient.post(n,{globalPluginConfig:t,actualPluginConfig:a},{headers:o}).then(r=>i.handleResponse(r))}isTokenizationAllowed(t){const a=`${this.getApiBasePath()}/tokenization-allowed`;return this.httpClient.post(a,{paymentMethodId:t},{headers:this.getBasicHeaders()}).then(n=>i.handleResponse(n)).catch(n=>i.handleResponse(n))}isComponentAllowed(t){const a=`${this.getApiBasePath()}/component-allowed`;return this.httpClient.post(a,{paymentMethodId:t},{headers:this.getBasicHeaders()}).then(n=>i.handleResponse(n)).catch(n=>i.handleResponse(n))}}const M={"multisafepay-verify-api-key":{success:"Die Verbindung wurde erfolgreich hergestellt",error:"Verbindung konnte nicht hergestellt werden. Bitte überprüfen Sie Ihre API-Anmeldeinformationen",apiButton:"API Verbindung testen"},"multisafepay-support":{documentation:"Dokumentation",api_documentation:"API Dokumentation",read_docs:"Lesen Sie in unserem Dokumentationen mehr über MultiSafepay und wie Sie mit uns starten können",manual:"Anleitung",changelog:"Änderungsprotokoll",faq:"FAQ",general_information:"Allgemeine Informationen",for_developers:"Für Entwickler",account:"Account","e-mail":"E-mail",telephone:"Telefon",contact:"Kontakt",account_needed:"Um dieses Plugin nutzen zu können benötigen Sie einen MultiSafepay-Account.",test_account:'Wenn Sie einen genauen Überblick über die Services von MultiSafepay bekommen möchten, können Sie einfach einen <a href="https://testmerchant.multisafepay.com/signup" target="_blank" rel="noopener">Test-Account</a> eröffnen.',assistance_integration_team:"Sie brauchen Hilfe? Kontaktieren Sie unser Integrations-Team:",live_account:'Wenn Sie einen Account eröffnen wollen, können Sie einfach einen <a href="https://merchant.multisafepay.com/signup" target="_blank" rel="noopener">Live-Account</a> eröffnen oder kontaktieren Sie das MultiSafepay Sales-Department:',external_link:"Öffnet in neuem Fenster",sales:"Verkauf",integration:"Integration"},"multisafepay-tokenization":{help_text:"Es ist erforderlich, die Zahlungskomponente zu aktivieren. Weitere Informationen zur Tokenisierung finden Sie in unserem Dokumentationscenter: https://docs.multisafepay.com/docs/recurring-payments"},"multisafepay-component":{help_text:"Sehen Sie sich unser Dokumentationscenter an, um mehr über die Zahlungskomponente zu erfahren: https://docs.multisafepay.com/docs/payment-components"},"multisafepay-direct":{help_text:"Die Zahlung auf der Checkout-Seite aktivieren."},"multisafepay-refund":{refund_options:"MultiSafepay Rückerstattungsoptionen",process_refund:"Rückerstattung verarbeiten",total_amount_refunded:"Gesamtbetrag rückerstattet",confirm_refund:"Rückerstattung bestätigen",cancel_refund:"Rückerstattung abbrechen",confirm_process_refund:"Bestätigen und Rückerstattung verarbeiten",confirm:"Bestätigen"}},A={"multisafepay-verify-api-key":{success:"Connection was successfully established",error:"Connection could not be established. Please check your API credentials",apiButton:"Validate API credentials"},"multisafepay-support":{documentation:"Documentation",api_documentation:"API Documentation",read_docs:"Read our documentation for more information about MultiSafepay and how to get started",manual:"Manual",changelog:"Changelog",faq:"FAQ",general_information:"General information",for_developers:"For developers",account:"Account","e-mail":"E-mail",telephone:"Telephone",contact:"Contact",account_needed:"To use this plugin you need a MultiSafepay account.",test_account:'If you would like to have a clear overview of what MultiSafepay has to offer, feel free to create a <a href="https://testmerchant.multisafepay.com/signup" target="_blank" rel="noopener">test account</a>.',assistance_integration_team:"Need assistance? Feel free to contact our integration team:",live_account:'If you would like to set up a live account, feel free to create a <a href="https://merchant.multisafepay.com/signup" target="_blank" rel="noopener">live account</a> or contact the MultiSafepay Sales department:',external_link:"Opens in new window",sales:"Sales",integration:"Integration"},"multisafepay-tokenization":{help_text:"It requires enabling the Payment Component. Check out our documentation center to found more about tokenization at https://docs.multisafepay.com/docs/recurring-payments"},"multisafepay-component":{help_text:"Check out our documentation center to found more about Payment Component at https://docs.multisafepay.com/docs/payment-components"},"multisafepay-direct":{help_text:"Enable the payment inside the checkout page"},"multisafepay-refund":{refund_options:"MultiSafepay refund options",process_refund:"Process refund",total_amount_refunded:"Total amount refunded",confirm_refund:"Confirm refund",cancel_refund:"Cancel refund",confirm_process_refund:"Confirm and process refund",confirm:"Confirm"}},C={"multisafepay-verify-api-key":{success:"De verbinding is succesvol tot stand gekomen",error:"De verbinding is niet tot stand gekomen. Controleer uw API gegevens",apiButton:"Controleer API gegevens"},"multisafepay-support":{documentation:"Documentatie",api_documentation:"API documentatie",read_docs:"Lees onze documentatie voor meer informatie over MultiSafepay en hoe u aan de slag kunt gaan",manual:"Handleiding",changelog:"Changelog",faq:"FAQ",general_information:"Algemene informatie",for_developers:"Voor Ontwikkelaars",account:"Account","e-mail":"E-mail",telephone:"Telefoon",contact:"Contact",account_needed:"Om deze plugin te gebruiken heeft u een MultiSafepay-account nodig.",test_account:'Wilt u een duidelijk overzicht van wat MultiSafepay te bieden heeft, maak dan gerust een <a href="https://testmerchant.multisafepay.com/signup" target="_blank" rel="noopener">testaccount</a> aan.',assistance_integration_team:"Assistentie nodig? Neem gerust contact op met ons integratie team:",live_account:'Wilt u een live account aanmaken, maak dan gerust een <a href="https://merchant.multisafepay.com/signup" target="_blank" rel="noopener">live account</a> aan of neem contact op met de MultiSafepay Sales afdeling:',external_link:"Opent in nieuw venster",sales:"Verkoop",integration:"Integratie"},"multisafepay-tokenization":{help_text:"Het is vereist om de betalingscomponent in te schakelen. Bekijk ons documentatiecentrum voor meer informatie over tokenization: https://docs.multisafepay.com/docs/recurring-payments"},"multisafepay-component":{help_text:"Bekijk ons documentatiecentrum voor meer informatie over Payment Component: https://docs.multisafepay.com/docs/payment-components"},"multisafepay-direct":{help_text:"Activeer de betaling binnen de afrekenpagina."},"multisafepay-refund":{refund_options:"MultiSafepay terugbetalingsopties",process_refund:"Terugbetaling verwerken",total_amount_refunded:"Totaal terugbetaald bedrag",confirm_refund:"Terugbetaling bevestigen",cancel_refund:"Terugbetaling annuleren",confirm_process_refund:"Bevestigen en terugbetaling verwerken",confirm:"Bevestigen"}},{Application:s}=Shopware;s.addServiceProvider("multiSafepayApiService",e=>{const t=s.getContainer("init");return new v(t.httpClient,e.loginService)});Shopware.Locale.extend("de-DE",M);Shopware.Locale.extend("en-GB",A);Shopware.Locale.extend("nl-NL",C);
//# sourceMappingURL=mltisafe-multi-safepay-CVx4Vc96.js.map
